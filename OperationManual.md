
## 📖 操作手册

### 1️⃣ 文件管理

#### 1.1 上传文件

**方式一：拖拽上传**
- 直接将 Excel 文件（.xlsx、.xls）拖拽到左侧上传区域
- 支持一次拖入多个文件

**方式二：点击上传**
- 点击上传区域，在弹出的文件选择窗口中选择文件
- 可按住 Ctrl 键多选文件

**限制说明**：
- 最多支持 6 个文件
- 达到上限后上传区域会变灰并禁用
- 同名文件会自动重命名（如：销售数据.xlsx → 销售数据-1.xlsx）

#### 1.2 切换文件

- 点击左侧文件池中的任意文件卡片
- 右侧会显示该文件的工作表标签页

#### 1.3 删除文件

**删除单个文件**：
- 点击文件卡片底部的"删除"按钮

**清空所有文件**：
- 点击文件池顶部的"清空全部文件"按钮
- 会弹出确认对话框，防止误操作

---

### 2️⃣ 规则构建

#### 2.1 添加规则

点击"添加新规则"按钮，会创建一个新的计算规则。每个规则包含：

**基本设置**：
1. **逻辑关系**（第 2 条规则起）：
   - `AND`：继续处理上一规则的数据（逐层筛选）
   - `OR`：从原始数据重新计算（结果累加）

2. **选择工作表**：
   - 点击下拉框，可选择任意文件的任意工作表
   - 支持跨文件选择
   - 已使用的工作表会显示 ✓ 标记

3. **计算类型**：
   - **单元格**：计算指定单元格的值（如 `A1`、`D6`）
   - **整行**：对指定行的所有单元格求和（如 `5` 表示第 5 行）
   - **整列（范围）**：对指定列的指定范围求和（如 `B` 列，2~10 行）
   - **自定义值**：手动输入固定数值（如固定费用 500）

4. **引用/值**：
   - 根据计算类型输入相应的引用或值
   - 列引用示例：`A`、`B`、`AA`
   - 单元格示例：`A1`、`B5`、`AC100`
   - 行引用示例：`1`、`5`、`100`

#### 2.2 AND 和 OR 逻辑

**OR 逻辑**（结果累加）：
```
规则1: 文件A-Sheet1 列B (结果: 1000)
OR
规则2: 文件B-Sheet2 列C (结果: 2000)
→ 最终结果 = 1000 + 2000 = 3000
```

**AND 逻辑**（逐层筛选）：
```
规则1: 文件A-Sheet1 列B，排除"测试"行 (结果: 1000)
AND
规则2: 继续筛选上一步数据，仅保留"已完成" (结果: 500)
→ 最终结果 = 1000 + 500 = 1500
```

#### 2.3 筛选条件

点击"点击启用筛选/排除"开关，可添加筛选条件：

**筛选模式**：
- **排除包含**：排除满足条件的行
- **仅保留包含**：只保留满足条件的行

**筛选类型**：

1. **关键字筛选**：
   - 输入列名（如 `A`）和关键字（如 `测试`）
   - 会筛选该列包含关键字的所有行

2. **列值筛选**：
   - 选择列名后，会自动加载该列的所有去重值
   - 可多选需要筛选的值
   - 空值显示为 `(空)`

**多条件组合**：
- 可添加多个筛选条件
- 条件之间支持 `且`（AND）和 `或`（OR）逻辑
- 示例：`列A包含"销售" 且 列B="已完成"`

#### 2.4 规则示例

**示例 1：简单累加**
```
规则1: 文件A-Sheet1 单元格 D6
OR
规则2: 文件B-Sheet2 列 B (2~10行)
OR
规则3: 自定义值 500（固定费用）
```

**示例 2：逐层筛选**
```
规则1: 文件A-Sheet1 列B，排除A列包含"测试"
AND
规则2: 继续上一步，仅保留C列="已完成"
AND
规则3: 继续上一步，排除D列包含"作废"
```

**示例 3：混合逻辑**
```
规则1: 文件A-Sheet1 列B，排除"测试"行
OR
规则2: 文件B-Sheet2 列C，仅保留"已完成"行
AND
规则3: 继续上一步，排除"作废"行
```

#### 2.5 删除和重置

- **删除单条规则**：点击规则卡片右上角的删除按钮
- **重置所有规则**：点击"重置所有规则"按钮，会清空所有规则并重置结果

---

### 3️⃣ 计算与结果

#### 3.1 执行计算

1. 添加至少一条规则
2. 点击"计算结果"按钮
3. 结果会显示在底部的结果面板中

#### 3.2 结果管理

**查看结果**：
- 结果会以醒目的大字体显示
- 自动格式化千分位（如 `1,234,567`）
- 显示处理过程的简要信息

**保存结果**：
1. 点击"保存到历史"按钮
2. 输入结果名称（默认为工作表名称）
3. 保存后会显示在右侧历史记录中

**重命名结果**：
- 点击历史记录中的编辑图标
- 输入新名称

**删除结果**：
- 点击历史记录中的删除图标
- 确认后删除

---

### 4️⃣ 高级技巧

#### 4.1 跨文件统计

场景：统计多个分公司的销售数据

```
规则1: 北京分公司.xlsx - Sheet1 列D (销售额)
OR
规则2: 上海分公司.xlsx - Sheet1 列D (销售额)
OR
规则3: 广州分公司.xlsx - Sheet1 列D (销售额)
```

#### 4.2 复杂筛选

场景：统计已完成且金额大于 1000 的订单

```
规则1: 订单数据.xlsx - Sheet1 列F (金额列)
筛选条件：
  1. 仅保留 列值 状态列="已完成"
  且
  2. 排除 关键字 金额列包含"<1000"
```

#### 4.3 多表联合计算

场景：统计本季度所有部门的总支出

```
规则1: Q1数据.xlsx - 销售部 列C
OR
规则2: Q1数据.xlsx - 技术部 列C
OR
规则3: Q1数据.xlsx - 市场部 列C
```

---

## ⚠️ 注意事项

1. **单元格引用**：
   - 单元格引用（如 `A1`）不受筛选条件影响
   - 始终访问原始数据的指定位置

2. **数据范围**：
   - 访问不存在的单元格会返回 0
   - 列求和的结束行留空表示自动计算到最后一行

3. **筛选逻辑**：
   - AND 规则只能对同一个工作表的数据进行逐层筛选
   - OR 规则可以选择不同的工作表，结果会累加

4. **性能优化**：
   - 大文件（>1000 行）建议使用列范围而非整列
   - 复杂筛选条件可能会影响计算速度

5. **数据格式**：
   - 非数字值会被解析为 0
   - 空单元格视为 0
